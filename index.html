<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Intensity Index Tracker</title>
<style>
  :root {
    color-scheme: light dark;
  }

  body {
    font-family: system-ui, sans-serif;
    text-align:center;
    margin:0;
    padding:2rem 1rem;
    transition: background 0.3s, color 0.3s;
  }

  /* Light / Dark dynamic backgrounds */
  @media (prefers-color-scheme: dark) {
    body { background: linear-gradient(180deg,#111,#222); color:#fff; }
  }
  @media (prefers-color-scheme: light) {
    body { background: linear-gradient(180deg,#e6e6e6,#fafafa); color:#111; }
  }

  h1 { font-size:2rem; margin-bottom:0.5rem; }
  #indexValue { font-size:3.5rem; font-weight:700; margin:1rem 0 2rem; }

  .btn {
    display:block;
    width:95%; max-width:480px;
    margin:1rem auto;
    padding:2rem;
    font-size:1.6rem;
    border:none;
    border-radius:1.2rem;
    color:#fff;
    background:#1e88e5;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
    transition: background 0.15s, transform 0.1s, filter 0.15s;
  }
  .btn:active {
    transform:scale(0.97);
    filter: brightness(1.3);
  }
  #tackleMinus { background:#444; }
  #possessionBtn.active { background:#d32f2f; }

  /* Flash animation */
  .flash {
    animation: flash 0.25s ease-out;
  }
  @keyframes flash {
    0% { filter:brightness(2); }
    100% { filter:brightness(1); }
  }

  .small {
    font-size:1rem;
    color:rgba(170,170,170,0.9);
    margin-top:2rem;
    line-height:1.6;
  }

  /* Reset slider */
  .slider-container {
    position: relative;
    width: 95%; max-width: 480px;
    height: 70px;
    background: #333;
    border-radius: 50px;
    margin: 3rem auto 0;
    overflow: hidden;
    user-select: none;
    touch-action: none;
    transition: background 0.3s;
  }
  .slider-text {
    position: absolute;
    width: 100%;
    top: 50%; left: 0;
    transform: translateY(-50%);
    color: #aaa;
    font-size: 1.3rem;
    pointer-events: none;
    transition: color 0.3s;
  }
  .slider-handle {
    position: absolute;
    top: 5px; left: 5px;
    width: 60px; height: 60px;
    border-radius: 50%;
    background: #1e88e5;
    transition: background 0.3s;
  }
  .slider-container.complete {
    background: #2e7d32;
  }
  .slider-container.complete .slider-handle {
    background: #43a047;
  }
  .slider-container.complete .slider-text {
    color: #fff;
  }

  footer {
    margin-top: 3rem;
    font-size: 0.85rem;
    opacity: 0.8;
  }
</style>
</head>
<body>

<h1>Intensity Index Tracker</h1>
<div id="indexValue">0.00</div>

<button id="tacklePlus" class="btn">+1 Tackle</button>
<button id="tackleMinus" class="btn">−1 Tackle</button>
<button id="possessionBtn" class="btn">Start Opposition Possession</button>

<div class="small">
  Tackles: <span id="tackleCount">0</span><br>
  Opposition Possession Time (min): <span id="timeCount">0.00</span>
</div>

<!-- Reset slider -->
<div class="slider-container" id="resetSlider">
  <div class="slider-text" id="sliderText">Slide to Reset</div>
  <div class="slider-handle" id="sliderHandle"></div>
</div>

<footer>Evan Dunne | Laois GAA</footer>

<script>
let tackles = 0;
let oppSecondsAccum = 0;
let oppStartMs = null;
let possessionActive = false;

const elIndex  = document.getElementById("indexValue");
const elTackles = document.getElementById("tackleCount");
const elTime   = document.getElementById("timeCount");
const btnPos   = document.getElementById("possessionBtn");
const slider   = document.getElementById("resetSlider");
const handle   = document.getElementById("sliderHandle");
const sliderText = document.getElementById("sliderText");

function vibrate(ms){ if("vibrate" in navigator){ navigator.vibrate(ms); } }

function getCurrentOppSeconds() {
  if (!possessionActive) return oppSecondsAccum;
  return oppSecondsAccum + (Date.now() - oppStartMs) / 1000;
}
function getOppMinutes() { return getCurrentOppSeconds() / 60; }
function getIntensity() {
  const mins = getOppMinutes();
  return mins > 0 ? tackles / mins : 0;
}
function render() {
  elTackles.textContent = tackles;
  elTime.textContent = getOppMinutes().toFixed(2);
  elIndex.textContent = getIntensity().toFixed(2);
}
function togglePossession() {
  if (!possessionActive) {
    oppStartMs = Date.now();
    possessionActive = true;
    btnPos.textContent = "Stop Opposition Possession";
    btnPos.classList.add("active");
  } else {
    oppSecondsAccum += (Date.now() - oppStartMs) / 1000;
    possessionActive = false;
    oppStartMs = null;
    btnPos.textContent = "Start Opposition Possession";
    btnPos.classList.remove("active");
    render();
  }
}

/* --- Flash + vibration for tackle buttons --- */
function flashButton(btn) {
  btn.classList.add("flash");
  setTimeout(()=>btn.classList.remove("flash"),200);
  vibrate(30);
}

document.getElementById("tacklePlus").onclick = e => {
  tackles++;
  render();
  flashButton(e.target);
};
document.getElementById("tackleMinus").onclick = e => {
  if (tackles>0) tackles--;
  render();
  flashButton(e.target);
};
btnPos.onclick = togglePossession;
setInterval(() => { if (possessionActive) render(); }, 250);
render();

/* ---------- Reset slider logic ---------- */
let startX = 0, currentX = 0, dragging = false;
function resetAll() {
  tackles = 0;
  oppSecondsAccum = 0;
  oppStartMs = null;
  possessionActive = false;
  btnPos.textContent = "Start Opposition Possession";
  btnPos.classList.remove("active");
  render();

  slider.classList.add("complete");
  sliderText.textContent = "✅ Game Reset";
  handle.style.left = (slider.offsetWidth - handle.offsetWidth - 5) + "px";
  vibrate(100); // haptic feedback

  setTimeout(() => {
    slider.classList.remove("complete");
    handle.style.left = "5px";
    sliderText.textContent = "Slide to Reset";
  }, 1500);
}
function startDrag(e) {
  dragging = true;
  startX = e.touches ? e.touches[0].clientX : e.clientX;
}
function onDrag(e) {
  if (!dragging) return;
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const dx = clientX - startX;
  const max = slider.offsetWidth - handle.offsetWidth - 5;
  currentX = Math.min(Math.max(5, dx + 5), max);
  handle.style.left = currentX + "px";
}
function endDrag() {
  if (!dragging) return;
  dragging = false;
  const max = slider.offsetWidth - handle.offsetWidth - 10;
  if (currentX >= max - 5) resetAll();
  else handle.style.left = "5px";
}
handle.addEventListener("mousedown", startDrag);
handle.addEventListener("touchstart", startDrag);
window.addEventListener("mousemove", onDrag);
window.addEventListener("touchmove", onDrag);
window.addEventListener("mouseup", endDrag);
window.addEventListener("touchend", endDrag);
</script>
</body>
</html>
