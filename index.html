<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Intensity Index Tracker</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root { color-scheme: light dark; }
  body {
    font-family: system-ui, sans-serif;
    text-align:center;
    margin:0;
    padding:2rem 1rem;
    transition: background 0.3s, color 0.3s;
  }

  /* Dynamic themes */
  @media (prefers-color-scheme: dark) {
    body { background: linear-gradient(180deg,#111,#222); color:#fff; }
    .stat-label { color:#ccc; }
  }
  @media (prefers-color-scheme: light) {
    body { background: linear-gradient(180deg,#f0f0f0,#ffffff); color:#111; }
    .stat-label { color:#333; }
  }

  h1 { font-size:2rem; margin-bottom:0.5rem; }
  #indexValue { font-size:3.5rem; font-weight:700; margin:1rem 0 2rem; }

  /* Buttons */
  .btn {
    display:block;
    width:95%; max-width:480px;
    margin:1rem auto;
    padding:2rem;
    font-size:1.6rem;
    border:none; border-radius:1.2rem;
    color:#fff; background:#1e88e5;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
    transition: background 0.15s, transform 0.1s, filter 0.15s;
  }
  #tackleMinus { background:#444; }
  #possessionBtn.active { background:#d32f2f; }
  .btn:active { transform:scale(0.96); filter:brightness(1.3); }

  /* Flash animation */
  .flash { animation: flash 0.25s ease-out; }
  @keyframes flash {
    0% { filter:brightness(2); transform:scale(1.05); }
    100% { filter:brightness(1); transform:scale(1); }
  }

  /* Stat boxes */
  .stats-container {
    display:flex; justify-content:center; align-items:center;
    gap:1rem; margin-top:2rem; flex-wrap:wrap;
  }
  .stat-box {
    flex:1 1 40%; min-width:150px; max-width:220px;
    background:#3333; border-radius:1rem;
    padding:1rem 0; box-shadow:0 3px 8px rgba(0,0,0,0.2);
  }
  .stat-label { font-size:1rem; margin-bottom:0.3rem; }
  .stat-value { font-size:2.4rem; font-weight:700; }

  /* Graph */
  #graphWrapper {
    width:95%; max-width:480px; margin:2rem auto 0;
    background:transparent;
  }
  canvas { width:100%; height:260px !important; }

  /* Slider */
  .slider-container {
    position: relative;
    width: 95%; max-width: 480px;
    height: 70px;
    background: #333;
    border-radius: 50px;
    margin: 3rem auto 0;
    overflow: hidden;
    user-select: none;
    touch-action: none;
    transition: background 0.3s;
  }
  .slider-text {
    position: absolute;
    width: 100%;
    top: 50%; left: 0;
    transform: translateY(-50%);
    color: #aaa;
    font-size: 1.3rem;
    pointer-events: none;
  }
  .slider-handle {
    position: absolute;
    top: 5px; left: 5px;
    width: 60px; height: 60px;
    border-radius: 50%;
    background: #1e88e5;
    transition: background 0.3s;
  }
  .slider-container.complete { background:#2e7d32; }
  .slider-container.complete .slider-handle { background:#43a047; }
  .slider-container.complete .slider-text { color:#fff; }

  footer { margin-top:3rem; font-size:0.85rem; opacity:0.8; }
</style>
</head>
<body>

<h1>Intensity Index Tracker</h1>
<div id="indexValue">0.00</div>

<button id="possessionBtn" class="btn">Start Opposition Possession</button>
<button id="tacklePlus" class="btn">+1 Tackle</button>
<button id="tackleMinus" class="btn">−1 Tackle</button>

<div class="stats-container">
  <div class="stat-box">
    <div class="stat-label">Tackles</div>
    <div class="stat-value" id="tackleCount">0</div>
  </div>
  <div class="stat-box">
    <div class="stat-label">Opp Poss Time</div>
    <div class="stat-value" id="timeDisplay">00:00</div>
  </div>
</div>

<!-- Graph -->
<div id="graphWrapper">
  <canvas id="intensityChart"></canvas>
</div>

<!-- Reset slider -->
<div class="slider-container" id="resetSlider">
  <div class="slider-text" id="sliderText">Slide to Reset</div>
  <div class="slider-handle" id="sliderHandle"></div>
</div>

<footer>Evan Dunne | Laois GAA</footer>

<script>
/* ------------ Core variables ------------ */
let tackles=0, oppSecondsAccum=0, oppStartMs=null, possessionActive=false;
const elIndex=document.getElementById("indexValue"),
      elTackles=document.getElementById("tackleCount"),
      elTimeDisplay=document.getElementById("timeDisplay"),
      btnPos=document.getElementById("possessionBtn"),
      slider=document.getElementById("resetSlider"),
      handle=document.getElementById("sliderHandle"),
      sliderText=document.getElementById("sliderText");

/* ------------ Haptic feedback ------------ */
function haptic(ms){
  if(navigator.vibrate) navigator.vibrate(ms);
  else {
    document.body.style.transition="background 0.1s";
    document.body.style.background="rgba(255,255,255,0.1)";
    setTimeout(()=>document.body.style.background="",150);
  }
}

/* ------------ Time helpers ------------ */
function formatTime(seconds){
  const m=Math.floor(seconds/60), s=Math.floor(seconds%60);
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
function getCurrentOppSeconds(){ return possessionActive?oppSecondsAccum+(Date.now()-oppStartMs)/1000:oppSecondsAccum; }
function getOppMinutes(){ return getCurrentOppSeconds()/60; }
function getIntensity(){
  const mins=getOppMinutes();
  return mins>0?tackles/mins:0;
}

/* ------------ Chart.js setup ------------ */
const ctx=document.getElementById('intensityChart').getContext('2d');
const chartData={ labels:[], datasets:[{ label:'Intensity Index',
  data:[], borderColor:'#1e88e5', backgroundColor:'rgba(30,136,229,0.15)',
  borderWidth:2, fill:true, tension:0.3 }]};
const intensityChart=new Chart(ctx,{
  type:'line', data:chartData,
  options:{ responsive:true, maintainAspectRatio:false,
    scales:{ x:{ title:{display:true,text:'Opp Poss Time (mins)'} },
             y:{ title:{display:true,text:'Intensity Index'}, beginAtZero:true } },
    plugins:{ legend:{display:false} } }});

/* ------------ Rendering ------------ */
function render(){
  elTackles.textContent=tackles;
  const seconds=getCurrentOppSeconds();
  elTimeDisplay.textContent=formatTime(seconds);
  elIndex.textContent=getIntensity().toFixed(2);
}
function flashButton(btn){ btn.classList.add("flash"); setTimeout(()=>btn.classList.remove("flash"),200); haptic(30); }

/* ------------ Button handlers ------------ */
function togglePossession(){
  if(!possessionActive){
    oppStartMs=Date.now(); possessionActive=true;
    btnPos.textContent="Stop Opposition Possession"; btnPos.classList.add("active");
  }else{
    oppSecondsAccum+=(Date.now()-oppStartMs)/1000; possessionActive=false; oppStartMs=null;
    btnPos.textContent="Start Opposition Possession"; btnPos.classList.remove("active"); render();
  }
}
document.getElementById("tacklePlus").onclick=e=>{tackles++;render();flashButton(e.target);};
document.getElementById("tackleMinus").onclick=e=>{if(tackles>0)tackles--;render();flashButton(e.target);};
btnPos.onclick=togglePossession;

/* ------------ Chart update ------------ */
setInterval(()=>{
  if(possessionActive||tackles>0){
    const minutes=getOppMinutes(), intensity=getIntensity();
    if(minutes>0){
      chartData.labels.push(minutes.toFixed(2));
      chartData.datasets[0].data.push(intensity.toFixed(2));
      if(chartData.labels.length>100){ chartData.labels.shift(); chartData.datasets[0].data.shift(); }
      intensityChart.update();
    }
  }
  if(possessionActive) render();
}, 3000);

/* ------------ Reset slider ------------ */
let startX=0,currentX=0,dragging=false;
function resetAll(){
  tackles=0; oppSecondsAccum=0; oppStartMs=null; possessionActive=false;
  chartData.labels=[]; chartData.datasets[0].data=[]; intensityChart.update();
  btnPos.textContent="Start Opposition Possession"; btnPos.classList.remove("active");
  render();
  slider.classList.add("complete"); sliderText.textContent="✅ Game Reset";
  handle.style.left=(slider.offsetWidth-handle.offsetWidth-5)+"px"; haptic(100);
  setTimeout(()=>{ slider.classList.remove("complete"); handle.style.left="5px";
    sliderText.textContent="Slide to Reset"; },1500);
}
function startDrag(e){ dragging=true; startX=e.touches?e.touches[0].clientX:e.clientX; }
function onDrag(e){
  if(!dragging)return;
  const clientX=e.touches?e.touches[0].clientX:e.clientX;
  const dx=clientX-startX;
  const max=slider.offsetWidth-handle.offsetWidth-5;
  currentX=Math.min(Math.max(5,dx+5),max);
  handle.style.left=currentX+"px";
}
function endDrag(){
  if(!dragging)return; dragging=false;
  const max=slider.offsetWidth-handle.offsetWidth-10;
  if(currentX>=max-5) resetAll(); else handle.style.left="5px";
}
handle.addEventListener("mousedown",startDrag);
handle.addEventListener("touchstart",startDrag);
window.addEventListener("mousemove",onDrag);
window.addEventListener("touchmove",onDrag);
window.addEventListener("mouseup",endDrag);
window.addEventListener("touchend",endDrag);

render();
</script>
</body>
</html>
